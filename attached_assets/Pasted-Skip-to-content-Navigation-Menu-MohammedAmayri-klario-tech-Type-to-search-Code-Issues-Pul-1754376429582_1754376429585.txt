Skip to content
Navigation Menu
MohammedAmayri
klario-tech

Type / to search
Code
Issues
Pull requests
Actions
Projects
Wiki
Security
Insights
Settings
Deploy Klario to Production
Add verification steps to ensure successful deployment to production #32
Jobs
Run details
build-and-deploy
failed now in 1m 41s
Search logs
1s
4s
2s
0s
2s
16s
27s
0s
0s
17s
0s
17s
12s
/usr/bin/docker run --name a1da1c1155a85684ff384b39929cdefbdce_e076cd --label 704a1d --workdir /github/workspace --rm -e "NODE_VERSION" -e "DOCKER_IMAGE_NAME" -e "DOCKER_TAG" -e "PROD_HOST" -e "PROD_USER" -e "PROD_PORT" -e "INPUT_HOST" -e "INPUT_USERNAME" -e "INPUT_KEY" -e "INPUT_PORT" -e "INPUT_SCRIPT" -e "INPUT_PASSPHRASE" -e "INPUT_PASSWORD" -e "INPUT_SYNC" -e "INPUT_USE_INSECURE_CIPHER" -e "INPUT_CIPHER" -e "INPUT_TIMEOUT" -e "INPUT_COMMAND_TIMEOUT" -e "INPUT_KEY_PATH" -e "INPUT_FINGERPRINT" -e "INPUT_PROXY_HOST" -e "INPUT_PROXY_PORT" -e "INPUT_PROXY_USERNAME" -e "INPUT_PROXY_PASSWORD" -e "INPUT_PROXY_PASSPHRASE" -e "INPUT_PROXY_TIMEOUT" -e "INPUT_PROXY_KEY" -e "INPUT_PROXY_KEY_PATH" -e "INPUT_PROXY_FINGERPRINT" -e "INPUT_PROXY_CIPHER" -e "INPUT_PROXY_USE_INSECURE_CIPHER" -e "INPUT_SCRIPT_STOP" -e "INPUT_ENVS" -e "INPUT_ENVS_FORMAT" -e "INPUT_DEBUG" -e "INPUT_ALLENVS" -e "INPUT_REQUEST_PTY" -e "HOME" -e "GITHUB_JOB" -e "GITHUB_REF" -e "GITHUB_SHA" -e "GITHUB_REPOSITORY" -e "GITHUB_REPOSITORY_OWNER" -e "GITHUB_REPOSITORY_OWNER_ID" -e "GITHUB_RUN_ID" -e "GITHUB_RUN_NUMBER" -e "GITHUB_RETENTION_DAYS" -e "GITHUB_RUN_ATTEMPT" -e "GITHUB_ACTOR_ID" -e "GITHUB_ACTOR" -e "GITHUB_WORKFLOW" -e "GITHUB_HEAD_REF" -e "GITHUB_BASE_REF" -e "GITHUB_EVENT_NAME" -e "GITHUB_SERVER_URL" -e "GITHUB_API_URL" -e "GITHUB_GRAPHQL_URL" -e "GITHUB_REF_NAME" -e "GITHUB_REF_PROTECTED" -e "GITHUB_REF_TYPE" -e "GITHUB_WORKFLOW_REF" -e "GITHUB_WORKFLOW_SHA" -e "GITHUB_REPOSITORY_ID" -e "GITHUB_TRIGGERING_ACTOR" -e "GITHUB_WORKSPACE" -e "GITHUB_ACTION" -e "GITHUB_EVENT_PATH" -e "GITHUB_ACTION_REPOSITORY" -e "GITHUB_ACTION_REF" -e "GITHUB_PATH" -e "GITHUB_ENV" -e "GITHUB_STEP_SUMMARY" -e "GITHUB_STATE" -e "GITHUB_OUTPUT" -e "RUNNER_OS" -e "RUNNER_ARCH" -e "RUNNER_NAME" -e "RUNNER_ENVIRONMENT" -e "RUNNER_TOOL_CACHE" -e "RUNNER_TEMP" -e "RUNNER_WORKSPACE" -e "ACTIONS_RUNTIME_URL" -e "ACTIONS_RUNTIME_TOKEN" -e "ACTIONS_CACHE_URL" -e "ACTIONS_RESULTS_URL" -e GITHUB_ACTIONS=true -e CI=true -v "/var/run/docker.sock":"/var/run/docker.sock" -v "/home/runner/work/_temp/_github_home":"/github/home" -v "/home/runner/work/_temp/_github_workflow":"/github/workflow" -v "/home/runner/work/_temp/_runner_file_commands":"/github/file_commands" -v "/home/runner/work/klario-tech/klario-tech":"/github/workspace" 704a1d:a1c1155a85684ff384b39929cdefbdce
======CMD======
set -e
# Prepare deploy dir
cd /tmp/klario-deploy

# Load image & copy files
docker load < klario-app.tar.gz
mkdir -p ~/klario && cp -r * ~/klario/
cd ~/klario
chmod +x scripts/*.sh

# Verify .env file exists
if [ ! -f .env ]; then
  echo "âŒ .env file not found! Files in directory:"
  ls -la
  exit 1
fi
echo "âœ… .env file found with $(wc -l < .env) lines"

# Bring up services
docker-compose -f docker-compose.prod.yml pull
docker-compose -f docker-compose.prod.yml up -d

# 1) App container health
echo "== App Container Health =="
for i in {1..10}; do
  if docker-compose -f docker-compose.prod.yml exec -T klario-app curl -fsS http://localhost:5000/health; then
    echo "âœ… App container healthy"; break
  fi
  sleep 5
done

# 2) Proxy/SSL health
echo "== Proxy/SSL Health =="
for i in {1..10}; do
  if curl -fsS https://getklario.com/health; then
    echo "âœ… Proxy & SSL healthy"; break
  fi
  sleep 5
done

echo "ðŸš€ Deployment completed successfully!"

======END======
out: The image klario:latest already exists, renaming the old one with ID sha256:e6716a76a07317421cd0dca1038d945a4c1608ed3a7a3f6926b8bfda32a14876 to empty string
out: Loaded image: klario:latest
out: âŒ .env file not found! Files in directory:
out: total 91756
out: drwxrwxr-x 3 *** ***     4096 Aug  5 06:27 .
out: drwxr-x--- 7 *** ***     4096 Aug  5 06:46 ..
out: -rw-r--r-- 1 *** ***      849 Aug  5 06:46 Caddyfile
out: -rw-r--r-- 1 *** ***     1982 Aug  5 06:46 docker-compose.prod.yml
out: -rw-r--r-- 1 *** ***     1069 Aug  5 06:46 env.production.template
out: -rw-r--r-- 1 *** *** 93929738 Aug  5 06:46 klario-app.tar.gz
out: drwxr-xr-x 2 *** ***     4096 Aug  5 06:27 scripts
2025/08/05 06:46:20 Process exited with status 1
0s
0s
0s
0s
